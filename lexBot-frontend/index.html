<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Lex Chat</title>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1488.0.min.js"></script>
  <style>/* your styles */</style>
</head>
<body>
  <div id="chat">
    <div id="messages"></div>
    <input id="userInput" placeholder="Ask something..." />
  </div>

  <!-- Amplify will generate this at build time -->
  <script src="env.js"></script>

  <script>
    // Use values generated into env.js
    const REGION   = window._env_.AWS_REGION;
    const IDPOOL   = window._env_.IDENTITY_POOL_ID;
    const BOT_ID   = window._env_.BOT_ID;
    const BOT_ALIAS= window._env_.BOT_ALIAS_ID;
    const LOCALE   = window._env_.LOCALE_ID || 'en_US';

    AWS.config.region = REGION;
    AWS.config.credentials = new AWS.CognitoIdentityCredentials({
      IdentityPoolId: IDPOOL
    });

    const lexruntime = new AWS.LexRuntimeV2();

    const sessionId = 'user-' + Date.now();

    document.getElementById('userInput').addEventListener('keypress', function(e){
      if (e.key === 'Enter') {
        const text = e.target.value;
        e.target.value = '';
        append('You: ' + text, 'user');

        const params = {
          botId: BOT_ID,
          botAliasId: BOT_ALIAS,
          localeId: LOCALE,
          sessionId,
          text
        };

        lexruntime.recognizeText(params, function(err, data){
          if (err) {
            console.error(err);
            append('Error: ' + (err.message || JSON.stringify(err)), 'bot');
          } else {
            if (data.messages && data.messages.length) {
              append('Bot: ' + data.messages.map(m => m.content).join(' '), 'bot');
            } else {
              append('Bot: (no message returned)', 'bot');
            }
          }
        });
      }
    });

    function append(txt, cls){
      const d = document.createElement('div'); d.className = cls; d.textContent = txt;
      document.getElementById('messages').appendChild(d);
      d.scrollIntoView();
    }
  </script>
</body>
</html>
